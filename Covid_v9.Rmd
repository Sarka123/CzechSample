---
title: "Predictors of Depression during the Covid-19, Czech sample report v0.5"
author: "Sarka Tesarova, Ondrej Pekacek, Alessandro Porrovecchio, Jiri Remr"
date: "Last edited `r format (Sys.time(),'%d. %m. %Y')`"
bibliography: bibliography.bib
output:
  html_document: 
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Study background

#### a. Goal of the study

This research project is based on the umbrella project "Pandemic Emergency in Social Perspective. Evidence from a large Web-survey research", designed and organized by principal investigators Linda Lombi (Università Cattolica del Sacro Cuore, Milan) and Marco Terraneo (Università Bicocca-Milano).

The principal goal of the international cross-sectional study is to explore the predictors of depression within the European context of the Covid-19 pandemic, specifically during the lockdown and social distancing period of March-April 2020.

Our team has decided to primarily focus on the impact of modifiable behavioral/lifestyle factors, such as exercise, alcohol and tobacco consumption, but, also, the usage of social media as a source of information about the pandemic. Our intention is to create and validate a depression model that these literature-based predictors should predict. Furthermore, we intend to explore the indirect pathway between social media consumption and depression mediated by the level of anxiety.

Supplementary data for this project, such as the survey questionnaire, original dataset and are accessible in our [Open Science Framework repository](https://osf.io/qs7zn/?view_only=91cf62078f614f519981d19d616c5644).

#### **b. Sampling**

Given the rapidly-developing nature of the Covid-19 pandemic, the principal research team (Lombi & Terraneo) chose a convenience sample, recruited through Facebook national groups using a snowballing technique. The goal was to collect at least 1000 responses per country.

The data collection has been conducted between March-April 2020 in the following eight countries: Italy, France, Germany, Spain, United Kingdom, Sweden, Poland, Czech Republic and were conducted by the members of the respective national teams (please see the research protocol in the [OSF repository](https://osf.io/qs7zn/?view_only=91cf62078f614f519981d19d616c5644).

This relatively non-random sampling is likely to result in a non-representative sample for the national populations. This is one of the limitations of this research and is reflected in the "data collection and sampling" part of the research protocol outlined by Linda Lombi and Marco Terraneo.

This approach, therefore, does not aim to compare country-samples, but, rather, to compare segments of the national samples, with a particular focus on the vulnerable social groups, determined by socio-demographic, lifestyle professional and living condition aspects.

#### c. Analysis plan

In order to comply with the principles of Open Science, we intend to split our analysis to two parts.

1.  Within the first part, we test the literature-derived hypotheses on the Czech sample (n=1484) of the international study and develop models. We also explore the dataset (here referred to as `COV19_05_agroup.sav`) inductively and consider the formulation of additional hypotheses for other predictors that might have been missed before the beginning of the study. To lower the chance of overfitting, we only consider the adding additional variables that have an empirical support based on our review of the existing literature. Towards the end of the first part of the project, we pre-register our hypotheses and other key research information (including this reproducible R code) at the [OSF Registries](https://osf.io/registries). While some of the team members have briefly interacted with the international dataset, they have not been involved in the pre-registration and hypothesis forming process in order to reduce biases by separating the exploratory and confirmatory phases of the research.
2.  In the second we will access the international dataset, which will include data from all of the countries that gathered at least 1000 responses. We will conduct confirmatory analyses, testing our models on this international sample, from which we will exclude the Czech sub-sample.

#### d. Core hypotheses

+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| Alternative Hypotheses                                                                                                                                                                                    | Variable                   | Literature                                                                                           |
+===========================================================================================================================================================================================================+============================+======================================================================================================+
| H1: **Female** gender is associated with **higher** levels of depression.                                                                                                                                 | q01                        | [@Salk2017; @Kowal2020; @Wang2020b; @Luo2020; @González-Sanguino2020]                                |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H2: **Higher** age is associated with **lower** levels of depression.                                                                                                                                     | q02                        | [@Kowal2020; @Shevlin2020; @Taylor2008; @Losada-Baltar2020; @González-Sanguino2020; @Carstensen2006] |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H3: People **in a relationship** experience **lower** levels of depression.                                                                                                                               | q03                        | [@Kowal2020; @Jacob2019]                                                                             |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H4: **Parenthood** is associated with significantly **different** levels of depression.                                                                                                                   | q04                        | [@Stanca2012; @Shevlin2020]                                                                          |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H5: **Higher** education is associated with **lower** levels of depression.                                                                                                                               | q11                        | [@Kowal2020; @Gloster2020; @Taylor2008]                                                              |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H6: **Use of social media** is associated with **higher** levels of depression.                                                                                                                           | q18_02                     | [@Bendau2020; @Dhir2018; @Primack2017]                                                               |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H7: **Physical contact** with friends and family is associated with **lower** levels of depression.                                                                                                       | q35_01, q35_03             | [@Gloster2020; @Tull2020; @Luo2020]                                                                  |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H8: Regular consumption of **alcohol** and **tobacco** is associated with **higher** levels of depression.                                                                                                | q38, q40                   | [@Stanton2020; @AwaworyiChurchill2017]                                                               |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H9: **Regular workouts** or physical activity are associated with **lower** levels of depression.                                                                                                         | q42                        | [@Harvey2018; @Schuch2016; @Kvam2016; @Krogh2017; @Stubbs2018]                                       |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H10: **Worse self-rated health quality** is associated with **higher** levels of depression.                                                                                                              | q47, q48, q47              | [@Ambresin2014; @Vindegaard2020; @Hossain2020]                                                       |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H11: Adequate level of public information about Covid-19 transmission and precautionary measures to prevent its spread (hand washing and mask wearing) is associated with **lower** levels of depression. | q20, 34_02, 34_07          | [@Wang2020; @Wang2020b]                                                                              |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H12: Economic impact on family                                                                                                                                                                            | q36                        | @Meltzer2009                                                                                         |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+
| H13: In addition to H6, we hypothesize an existence of a causal pathway leading from **social media exposure** to **depression**, which is mediated by **anxiety** and moderated by **age**.              | q02, q18_02, anxiety_index | [@Bendau2020; @Rasmussen2020; @Wheaton2021; @Vannucci2017; @Mertens2020]                             |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+------------------------------------------------------------------------------------------------------+

## 2. Analysis of the Czech sample

#### a. Loading the dataset, required R packages and data wrangling

The code below can be run in R or in R IDE, such as R Studio. We used R Markdown within the R Studio to compose this report and used the open-source [jamovi software](jamovi.org) (a R GUI) to conduct some of the exploratory analyses that are then replicated here.

```{r loading packages and dataset, message=FALSE, warning=FALSE}

#The following packages might need to be installed onto your version of R prior to the running of the code below.

library(udpipe)
library(MASS)
library(medmod)
library(lavaan)
library(lavaanPlot)
library(wordcloud)
library(corrplot)
library(tidytext)
library(tidyverse)
library(haven)
library(jmv)

#Package lavaanPlot is currently not available on CRAN, install through devtools::install_github("alishinski/lavaanPlot")

#We load the original Czech dataset (in SPSS format) from a local directory.
data <- haven::read_sav(file = "COV19_05_agroup.sav")

#We also try to limit the decimals to three significant figures
options(digits = 3)

#Finally, for reproductible results, we run session_info() to see the details on the R & packages versions that were used to compile this document.
devtools::session_info()
```

```{r data cleaning and wrangling}

#Firstly, because the source file is an SPSS file, we need to specify that we would like to see value labels (such as Male/Female) for selected variables, as opposed to just numeric values (such as 1/2). This is not essential for the analysis, but seeing the names of labels will enable better understanding of the results.

data <- data %>% 
        mutate(q01 = haven::as_factor(q01)) %>%
        mutate(q03 = haven::as_factor(q03)) %>%
        mutate(q04 = haven::as_factor(q04)) %>%
        mutate(q11 = haven::as_factor(q11)) %>%
        mutate(q38 = haven::as_factor(q38)) %>%
        mutate(q40 = haven::as_factor(q40)) %>%
        mutate(q42 = haven::as_factor(q42)) %>%
        mutate(q47 = haven::as_factor(q47)) %>%
        mutate(q48 = haven::as_factor(q48)) %>%
        mutate(q49 = haven::as_factor(q49)) %>%
        mutate(Q4_AGE_r = haven::as_factor(Q4_AGE_r, ordered = TRUE))

#For convenience, we translate the core variables labels from Czech to English.

levels(data$q01) <- list(female = "Žena", 
                         male = "Muž")
levels(data$q03) <- list(single = "Svobodný/Svobodná", 
                         relationship = "V partnerském vztahu", 
                         married = "Ženatý/Vdaná", 
                         divorced = "Rozvedený/Rozvedená", 
                         widowed = "Vdovec/Vdova")

levels(data$q04) <- list(yes = "Ano", no = "Ne")
levels(data$q04) <- list(yes = "Ano", no = "Ne")

levels(data$q11) <- list(unfin_element = "Nedokončené základní", 
                         element = "Základní vzdělání", 
                         unfin_hs = "Vyučen/a nebo střední bez maturity", 
                         hs = "Středoškolské s maturitou a vyšší odborné",
                         undergrad = "Vysokoškolské (bakalářský stupeň)", 
                         postgrad = "Vysokoškolské (magisterské, doktorské nebo vyšší)")

levels(data$q38) <- list(yes = "Ano", no = "Ne")
levels(data$q40) <- list(yes = "Ano", no = "Ne")
levels(data$q42) <- list(yes = "Ano", no = "Ne")

levels(data$q47) <- list(excellent = "Velmi dobrý",
                         good = "Dobrý", 
                         neutral = "Ani dobrý ani špatný", 
                         bad = "Špatný", 
                         very_bad = "Velmi špatný")

levels(data$q48) <- list(yes = "Ano", no = "Ne")
levels(data$q49) <- list(limits = "Velmi omezuje", 
                         partially_limits = "Částečně omezuje", 
                         no_limits = "Vůbec neomezuje")

#Secondly, we rename key variables to a more human-readable form.

data <- data %>% 
        rename(q01_gender = q01) %>% 
        rename(q02_age = q02) %>%
        rename(q03_relationship_type = q03) %>%
        rename(q04_children = q04) %>%
        rename(q11_education = q11) %>%
        rename(q18_02_soc_media_info = q18_02) %>%
        rename(q35_01_contact_close_family = q35_01) %>%
        rename(q35_03_contact_friends = q35_03) %>%
        rename(q38_alcohol = q38) %>%
        rename(q40_smoking = q40) %>%
        rename(q42_sport = q42) %>%
        rename(q47_self_reporting_health = q47) %>%
        rename(q48_chronic_illness = q48) %>%
        rename(q49_health_limitations = q49) %>%

#Thirdly, we rename variables related to anxiety, which we will use to construct an anxiety index with factor analysis (to use for path analysis afterwards).
  
        rename(q30_anxiety_infection_covid = q30) %>%
        rename(q31_anxiety_infection_friends = q31) %>%
        rename(q33_01_anxiety_situation = q33_01) %>%
        rename(q33_02_anxiety_low_control = q33_02) %>%
        rename(q33_03_anxiety_survival_covid = q33_03) %>%
        rename(q33_04_anxiety_change_employment = q33_04) %>%
        rename(q33_05_anxiety_infecting_others = q33_05) 

#Finally, we create dummy variable for social media as a source of information by replacing NA values. We also assign it appropriate factor levels

data$q18_02_soc_media_info[is.na(data$q18_02_soc_media_info)] <- 0

data <- data %>% 
        mutate(q18_02_soc_media_info = haven::as_factor(q18_02_soc_media_info, ordered = TRUE))

levels(data$q18_02_soc_media_info) <- list(yes = "Sociální média", no = "0")
```

#### b. Sample descriptive statistics: Depression index (PHQ8)

The PHQ-8 dependent variable intend to determine the presence and severity of major depressive disorder. The PHQ-8 construction is standardized and based on the established methodology [@Kroenke2009]. The PHQ-8 questionnaire asks the number of days in the past 2 weeks the respondent had experienced a specific depressive symptom.

This variable was recoded by the international team from 8 survey items (see the [OSF project page](https://osf.io/qs7zn/?view_only=91cf62078f614f519981d19d616c5644) for the precise syntax) and is thus already present in the version of this dataset.

```{r PHQ8 descriptives}

#To summarize the dependent continuous variable, we use the descriptives() function from the jmv package.

jmv::descriptives(
    data = data,
    vars = "PHQ8",
    freq = TRUE,
    box = TRUE,
    median = FALSE,
    range = TRUE,
    se = TRUE, 
    quart = TRUE)
```

#### c. Sample descriptive statistics: Demographic characteristics (Czech sample)

In the next step, we asses the demographic characteristics of the respondents in the Czech sample.

```{r sample demography descriptives}

#To summarize the key demographic variables, we use the descriptives() function from the jmv package.

jmv::descriptives(
    data = data,
    vars = vars("q01_gender",
                "Q4_AGE_r",
                "q03_relationship_type",
                "q04_children",
                "q11_education"),
    bar = TRUE,
    freq = TRUE,
    missing = FALSE,
    mean = FALSE,
    median = FALSE,
    sd = FALSE,
    min = FALSE,
    max = FALSE)
```

## 3. Building regression model to predict PHQ8

After descriptive statistics, we continue with building and fitting of the regression model based on our hypotheses.

The model has one independent continuous variable - PHQ8. The only other continuous variable in the model is q02_age, which is inputted as a covariate. The rest of the variables are either categorical (both nominal and ordinal) or binary. The linreg() function from the jmv package automatically handles them as dummy variables with reference levels and it is thus not necessary to create further dummy variables prior to this analysis.

#### a. Overview of correlations between individual predictors and outcome

As a first step in the regression model creation, we conduct a correlation analysis. Since we do not presume linearity between all of the variables, we use Spearman's rank coefficient instead of Pearson's *r**.*** The results below need to be interpreted with caution, since some of the variables are categorical (such as q03_relationship_type), without a defined order. For categorical variables, comparisons using Chi-Square test would be more appropriate, however, in this step, we are primarily looking at the relationship between the outcome (PHQ8) and the theorized predictors.

```{r correlation matrix}

#While the dataset has been already imported, the values of factor variables were changed from numerics to text strings, therefore that dataset is unsuitable for correlation analysis. To solve this, we create a parallel dataset, again renaming the key variables to a more understandable form.

data_corr <- read_sav(file = "COV19_05_agroup.sav")
options(digits = 3)

data_corr <- data_corr %>% 
              rename(q01_gender = q01) %>% 
              rename(q02_age = q02) %>% 
              rename(q03_relationship_type = q03) %>% 
              rename(q04_children = q04) %>% 
              rename(q11_education = q11) %>% 
              rename(q18_02_soc_media_info = q18_02) %>% 
              rename(q35_01_contact_close_family = q35_01) %>% 
              rename(q35_03_contact_friends = q35_03) %>% 
              rename(q38_alcohol = q38) %>% 
              rename(q40_smoking = q40) %>% 
              rename(q42_sport = q42) %>% 
              rename(q47_self_reporting_health = q47) %>% 
              rename(q48_chronic_illness = q48) %>% 
              rename(q49_health_limitations = q49)

data_corr$q18_02_soc_media_info[is.na(data_corr$q18_02_soc_media_info)] <- 0

#Dataset simplification to only the variables specified with hypotheses

data_vars <- c("PHQ8", 
               "q02_age",
               "q01_gender", 
               "q04_children", 
               "q42_sport", 
               "q40_smoking", 
               "q38_alcohol", 
               "q35_01_contact_close_family", 
               "q35_03_contact_friends", 
               "q18_02_soc_media_info", 
               "q03_relationship_type", 
               "q47_self_reporting_health", 
               "q49_health_limitations", 
               "q11_education", 
               "q48_chronic_illness")

data_corr <- data_corr[data_vars]

#SPEARMAN CORRELATION
corr_spearman <- cor(data_corr, method = "spearman", use = "complete.obs")

corrplot(corr_spearman, method = "color")

print(corr_spearman)
```

#### b. Theory derived, inductively built regression model

In the first set of models, we avoid potentially biased modifications, such as pairwise comparisons, which could lead to overfitting. Instead, we build five successive models in total ("blocks" in the syntax).

First model (from the set of 5) uses only the demographic characteristics as predictors. Second model add the effect of the social media consumption. Third model adds lifestyle variables, such as alcohol, smoking, sport and social contacts. The fourth model further adds the variables related to self-rated health quality. Finally, the fifth model controls for the age by adding it as a covariate. The performance of each model could be seen in the output below.

```{r theory-driven regression model, warning=FALSE}

jmv::linReg(
    data = data,
    dep = "PHQ8",
    covs = "q02_age",
    factors = vars("q01_gender", 
                   "q04_children", 
                   "q42_sport", 
                   "q40_smoking", 
                   "q38_alcohol", 
                   "q35_01_contact_close_family", 
                   "q35_03_contact_friends", 
                   "q18_02_soc_media_info", 
                   "q03_relationship_type", 
                   "q47_self_reporting_health", 
                   "q49_health_limitations", 
                   "q11_education", 
                   "q48_chronic_illness"),
    blocks = list(
        list(
            "q01_gender",
            "q03_relationship_type",
            "q04_children",
            "q11_education"),
        list(
            "q18_02_soc_media_info"),
        list(
            "q40_smoking",
            "q42_sport",
            "q38_alcohol",
            "q35_01_contact_close_family",
            "q35_03_contact_friends"),
        list(
            "q47_self_reporting_health",
            "q48_chronic_illness",
            "q49_health_limitations"),
        list(
            "q02_age")),
    refLevels = list(
        list(
            var="q01_gender",
            ref="female"),
        list(
            var="q04_children",
            ref="no"),
        list(
            var="q42_sport",
            ref="no"),
        list(
            var="q40_smoking",
            ref="yes"),
        list(
            var="q38_alcohol",
            ref="yes"),
        list(
            var="q35_01_contact_close_family",
            ref="1"),
        list(
            var="q35_03_contact_friends",
            ref="1"),
        list(
            var="q18_02_soc_media_info",
            ref="yes"),
        list(
            var="q03_relationship_type",
            ref="single"),
        list(
            var="q47_self_reporting_health",
            ref="very_bad"),
        list(
            var="q49_health_limitations",
            ref="limits"),
        list(
            var="q11_education",
            ref="unfin_element"),
        list(
            var="q48_chronic_illness",
            ref="yes")),
    r2Adj = TRUE,
    aic = TRUE,
    bic = TRUE,
    rmse = TRUE,
    modelTest = TRUE,
    anova = TRUE,
    ci = TRUE,
    stdEst = TRUE,
    ciStdEst = TRUE,
    durbin = TRUE,
    collin = TRUE)
```

#### c. Stepwise regression model, step 1: algorithmic selection

As an alternative approach to the theory-derived, inductively build set of models, we choose to use the stepwise regression - combining forward with stepwise selection of the predictors. By using both of the Akaike information criterion (AIC) and Bayesian information criterion (BIC) to select the best-performing model, the algorithm from the MASS package arrives at two simpler models, compared to the 14 predictor variables selected with the previous manual approach. However, while these two models perform well with this particular sample, there is a significant chance of underperformance on the international sample, since stepwise regression is prone to overfitting.

Using AIC-ranked stepwise selection, the algorithm arrives at 9-predictor model.

```{r automatic stepwise regression model AIC-selected}

#We are using the MASS package, which contains stepAIC() function for stepwise regression model selection

#Dataset simplification to only the variables specified with hypotheses

data_linreg <- data[data_vars]

# Fit the full linear model using lm() function from base R
full.model_MASS <- lm(PHQ8 ~.,
                      data = data_linreg,
                      na.action = na.omit)

# Stepwise regression model using MASS package, ranks on AIC
step.model_AIC <- stepAIC(full.model_MASS, 
                          direction = "both", 
                          trace = FALSE)

# Summary of model based on AIC
base::summary(step.model_AIC)

```

Using BIC-ranked stepwise selection, the algorithm arrives at 7-predictor model.

```{r automatic stepwise regression model BIC-selected}

# Stepwise regression model using MASS package, ranks on BIC
step.model_BIC <- stepAIC(full.model_MASS, 
                          direction = "both",
                          trace = FALSE, 
                          k = log(nrow(data_linreg)))

# Summary of model based on BIC
base::summary(step.model_BIC)
```

#### d. Stepwise regression model, step 2: final AIC and BIC-driven model

In order to allow direct comparison with the manually-selected model, we input the chosen model (based on the AIC and BIC criterion) from the previous step into the linreg() function of the jmv package. The first, simpler model has the variables from the BIC-selected model. The second, more complex model, has variables from AIC-selected stepwise model.

```{r stepwise selection-built linear model}

#To construct this regression model, we use the linReg() function from the jmv package.

jmv::linReg(
    data = data,
    dep = "PHQ8",
    covs = "q02_age",
    factors = vars("q01_gender", 
                   "q40_smoking", 
                   "q04_children", 
                   "q38_alcohol", 
                   "q18_02_soc_media_info", 
                   "q03_relationship_type", 
                   "q47_self_reporting_health", 
                   "q49_health_limitations"),
    blocks = list(
        list(
            "q02_age",
            "q01_gender",
            "q04_children",
            "q47_self_reporting_health",
            "q49_health_limitations",
            "q18_02_soc_media_info"),
          list(
            "q38_alcohol",
            "q40_smoking",
            "q03_relationship_type")),
    refLevels = list(
        list(
            var="q01_gender",
            ref="male"),
        list(
            var="q04_children",
            ref="yes"),
        list(
            var="q38_alcohol",
            ref="yes"),
        list(
            var="q40_smoking",
            ref="yes"),
        list(
            var="q18_02_soc_media_info",
            ref="yes"),
        list(
            var="q03_relationship_type",
            ref="single"),
        list(
            var="q47_self_reporting_health",
            ref="very_bad"),
        list(
            var="q49_health_limitations",
            ref="limits")),
    r2Adj = TRUE,
    aic = TRUE,
    bic = TRUE,
    rmse = TRUE,
    modelTest = TRUE,
    anova = TRUE,
    ci = TRUE,
    stdEst = TRUE,
    ciStdEst = TRUE,
    durbin = TRUE,
    collin = TRUE)
```

## 4. Anxiety factor as a mediator for depression

#### a. Creation of the Covid-related Anxiety index, step 1: overview of survey items

Aside from the regression model, we intend to explore the mediating role of anxiety between the consumption of social media and depression through a mediation/moderation analysis (in section 5).

In this section, we aim to construct an anxiety index from several survey items. As a first step, we select the survey items, which should be the manifestation of the latent factor of anxiety.

These survey items are:

+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| Survey question (1-10 scale)                                                                                                          | Original variable | Renamed variable name            |
+=======================================================================================================================================+===================+==================================+
| How scared are you of the risk of getting sick?                                                                                       | q30               | q30_anxiety_infection_covid      |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| How scared are you of the risk that someone in your family or network of friends will get COVID-19?                                   | q31               | q31_anxiety_infection_friends    |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| I feel very anxious about the health emergency.                                                                                       | q33_01            | q33_01_anxiety_situation         |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| I think I have little control over whether I get the infection.                                                                       | q33_02            | q33_02_anxiety_low_control       |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| I am scared that I will not be able to survive if I get sick due to COVID-19 or I got sick and I was scared that I would not survive. | q33_03            | q33_03_anxiety_survival_covid    |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| I thought about quitting my job / dropping out of school due to COVID-19.                                                             | q33_04            | q33_04_anxiety_change_employment |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+
| I am afraid of transmitting the coronavirus to others.                                                                                | q33_05            | q33_05_anxiety_infecting_others  |
+---------------------------------------------------------------------------------------------------------------------------------------+-------------------+----------------------------------+

#### b. Creation of the Covid-related Anxiety index, step 2: anxiety items descriptives and pre-processing

After the selection, we analyze these survey items with a set of descriptive statistics. To follow the established principles pertaining to the factor analyses, we also split the sample into two randomly chosen halves. The first half of the data set will be used for the Exploratory Factor Analysis, while the second half will be used by the Reliability and Confirmatory Factor Analyses.

```{r anxiety items descriptives}

jmv::descriptives(
    data = data,
    vars = vars("q30_anxiety_infection_covid", 
                "q31_anxiety_infection_friends", 
                "q33_01_anxiety_situation", 
                "q33_02_anxiety_low_control", 
                "q33_03_anxiety_survival_covid", 
                "q33_04_anxiety_change_employment", 
                "q33_05_anxiety_infecting_others"),
    hist = TRUE,
    min = FALSE,
    max = FALSE)

#Imputation of missing variables


# We also split the sample into two halfs. The "training" half, on which we conduct the EFA analysis and "test" part, on which we test our construct through CFA.

set.seed(2021)
train_set <- data %>% slice_sample(n = 742)
test_set <- setdiff(data,train_set)
```

#### c. Creation of the Covid-related Anxiety index, step 3: Exploratory Factor Analysis of anxiety items

In the next step, we conduct an Exploratory Factor Analysis on these variables.

In line with best practices, we conduct the assumption checks (KMO and Bartlett's Sphericity tests), set a cutoff for eigenvalue of \>1 and hide factor loading below 0.4.

The result is therefore a one-factor construct, which includes all of the variables, except for the "q33_04_anxiety_change_employment", which does not seem to be a good fit for the manifestation of anxiety within this group of variables.

```{r anxiety items Exploratory Factor Analysis}

#To conduct the EFA, we use the efa() function from the jmv package on the "train" data set (as opposed to the "test" dataset used for CFA)

jmv::efa(
    data = train_set,
    vars = vars("q30_anxiety_infection_covid", 
                "q31_anxiety_infection_friends", 
                "q33_01_anxiety_situation", 
                "q33_02_anxiety_low_control", 
                "q33_03_anxiety_survival_covid", 
                "q33_04_anxiety_change_employment", 
                "q33_05_anxiety_infecting_others"),
    nFactorMethod = "eigen",
    nFactors = 1,
    minEigen = 1,
    rotation = "promax",
    hideLoadings = 0.4,
    screePlot = TRUE,
    factorSummary = TRUE,
    kmo = TRUE,
    bartlett = TRUE)
```

#### d. Creation of the  Covid-related Anxiety index, step 3: Reliability Analysis of the index items

Secondly, we conduct a reliability analysis of the anxiety factor. We use a cutoff value of 0.7 for both McDonald's omega and Cronbach's Alpha. The scale passes this cutoff and the statistics would not be improved if any of the items were dropped.

```{r anxiety index reliability analysis}

#To conduct the reliability analysis, we use the reliability() function from the jmv package on the "test" data set (as opposed to the "train" dataset used for EFA)

jmv::reliability(
    data = test_set,
    vars = vars("q30_anxiety_infection_covid", 
                "q31_anxiety_infection_friends", 
                "q33_01_anxiety_situation", 
                "q33_02_anxiety_low_control", 
                "q33_03_anxiety_survival_covid", 
                "q33_05_anxiety_infecting_others"),
    omegaScale = TRUE,
    alphaItems = TRUE,
    omegaItems = TRUE)
```

#### e. Creation of the Covid-related Anxiety index, step 4: Confirmatory Factor Analysis of the index items

According to the [commonly used cut-offs](https://www.cscu.cornell.edu/news/Handouts/SEM_fit.pdf) for estimating CFA fit, we report that the chi-square is 159 (p \< 0.001) and the Standardized Root Mean Square Residual is 0.0521 (cut-off SRMR \<0.08), which indicates a good fit. However, Root Mean Square Error of Approximation (90% CI) is 0.130-0.171 (cut-off \< 0.08) and the Comparative Fit Index is 0.887 (cut-off ≥.90), which does not indicate a good-fit.

```{r anxiety index Confirmatory Factor Analysis}

#To conduct the CFA, we use the cfa() function from the jmv package on the "test" data set (as opposed to the "train" dataset used for EFA)

jmv::cfa(
    data = test_set,
    factors = list(
        list(
            label="Anxiety",
            vars=c(
                "q30_anxiety_infection_covid",
                "q31_anxiety_infection_friends",
                "q33_01_anxiety_situation",
                "q33_02_anxiety_low_control",
                "q33_03_anxiety_survival_covid",
                "q33_05_anxiety_infecting_others"))),
    resCov = list(),
    ci = TRUE,
    stdEst = TRUE,
    factCovEst = FALSE,
    fitMeasures = c("cfi", "tli", "rmsea", "srmr"),
    corRes = TRUE)
```

#### f. Creation of Covid-related Anxiety Index , step 5: creation and descriptives

After Reliability analysis and CFA, we combine the multiple variables into one named anxiety_index. We also render visualization and descriptive statistics for the new anxiety_index variable.

```{r anxiety index creation and descriptives}

#Creating the anxiety index, consisting of the average the values of the multiple variables selected through factor analysis to represent the underlying construct of anxiety.

anxiety_index <- apply(cbind(data$q30_anxiety_infection_covid,
                             data$q31_anxiety_infection_friends,
                             data$q33_01_anxiety_situation,
                             data$q33_02_anxiety_low_control,
                             data$q33_03_anxiety_survival_covid,
                             data$q33_05_anxiety_infecting_others), 1, mean)

#Adding the vector as an column to the existing dataset.

data <- cbind(data, anxiety_index)

#To summarize the anxiety_index variable, we use the descriptives() function from the jmv package.

jmv::descriptives(
    data = data,
    missing = TRUE,
    vars = "anxiety_index",
    sd = TRUE,
    median = FALSE,
    quart = TRUE,
    range = TRUE,
    box = TRUE)
```

## 5. Simplified age-moderated & anxiety-mediated model

#### a. Simple mediation model (without moderator)

To explore our hypothesized pathway (see H11) between social media exposure and depression, partially mediated by anxiety, we conduct a mediation analysis.

```{r simple mediation model}

#To create the mediation model, we use the med() function from the medmod package.Before running the model, we need to transform the social media string dummy (yes/no) back to its numeric form.

levels(data$q18_02_soc_media_info) <- list("1" = "yes", "2" = "no")
data$q18_02_soc_media_info <- as.numeric(as.character(data$q18_02_soc_media_info))

# Centering continuous variables (without scaling)
data <- data %>% 
        mutate(PHQ8.c = scale(PHQ8, scale = FALSE)) %>% 
        mutate(q02_age.c = scale(q02_age, scale = FALSE)) %>%
        filter(!is.na(anxiety_index)) %>%
        mutate(anxiety_index.c = scale(anxiety_index, scale = FALSE)) %>%
        mutate(q18_02_soc_media_info.c = scale(q18_02_soc_media_info, 
                                               scale = FALSE))

#Seed for reproducibility of the results (due to bootstrap)
set.seed(2021)

medmod::med(
    data = data,
    dep = "PHQ8.c",
    med = "anxiety_index.c",
    pred = "q18_02_soc_media_info.c",
    estMethod = "bootstrap",
    bootstrap = 1000,
    ci = TRUE,
    pm = TRUE,
    paths = TRUE,
    label = TRUE)
```

#### b. Complex age-moderated mediation model

To account for the significant effect of age, which is presumed to influence both the social media exposure and the depression pathway, we build a complex model using the lavaan package, where age acts as an additional moderator.

```{r moderated mediation model}

#Mediation analysis (path analysis framework, SEM) using lavaan package.

#For reproducibility of results (because we use bootstrap)
set.seed(2021)

#First, we specify the pathways
spec_mod <- "
#Regressions
anxiety_index.c ~ a1*q18_02_soc_media_info.c + a2*q02_age.c + a3*q18_02_soc_media_info.c:q02_age.c
PHQ8.c ~ cdash1*q18_02_soc_media_info.c + cdash2*q02_age.c + cdash3*q18_02_soc_media_info.c:q02_age.c + b1*anxiety_index.c

#Mean of centered age moderator (for use in simple slopes)
q02_age.c ~ q02_age.c.mean*1

#Variance of centered age moderator (for use in simple slopes)
q02_age.c ~~ q02_age.c.var*q02_age.c

#Indirect effects conditional on moderator (a1 + a3*ModValue)*b1
indirect.SDbelow := (a1 + a3*(q02_age.c.mean-sqrt(q02_age.c.var)))*b1
indirect.SDabove := (a1 + a3*(q02_age.c.mean+sqrt(q02_age.c.var)))*b1

#Direct effects conditional on moderator (cdash1 + cdash3*ModValue)
direct.SDbelow := cdash1 + cdash3*(q02_age.c.mean-sqrt(q02_age.c.var)) 
direct.SDabove := cdash1 + cdash3*(q02_age.c.mean+sqrt(q02_age.c.var))

#Total effects conditional on moderator
total.SDbelow := direct.SDbelow + indirect.SDbelow
total.SDabove := direct.SDabove + indirect.SDabove

#Proportion mediated conditional on moderator
prop.mediated.SDbelow := indirect.SDbelow / total.SDbelow
prop.mediated.SDabove := indirect.SDabove / total.SDabove

#Index of moderated mediation
index.mod.med := a3*b1
"

#Secondly, we fit/estimate the model and we use bootstrap for robustness.
fit_mod <- lavaan::sem(model = spec_mod,
               data = data,
               se = "bootstrap",
               bootstrap = 1000)

#Finally, we summarize the model
lavaan::summary(fit_mod, 
                fit.measures = FALSE, 
                rsquare = TRUE, 
                standardize = TRUE)

#We can also vizalize the path diagram with lavaanPlot package
lavaanPlot(model = fit_mod)
```

## 6. Visualizing the qualitative responses using Word Clouds

Part of the survey (q50) was dedicated to the comments of the respondents on their situation. To visualize this textual data, we use two pairs of two word clouds.

First Word Cloud pair visualizes the most common tokens and lemma (size and color represents frequency of the word). Second Word Cloud pair uses sentiment analysis technique to create two distinct word clouds (using only tokens, not lemma), one visualizes only words with positive emotional sentiment, while the second only words with negative sentiment.

#### a. Word Clouds of all textual responses, step 1: pre-processing and tokens Word Cloud

```{r Word Cloud all tokens, fig.height=9, fig.width=9, message=FALSE}

#Remove stop words - first, we load the public stop word list
stop_words_cz <- read_csv("https://raw.githubusercontent.com/stopwords-iso/stopwords-cs/master/stopwords-cs.txt", col_names = "word")
   
## Should the above link become obsolete, alternative source can be reached using "stopwords" library: stop_words_cz <- as_tibble_col(stopwords::stopwords("cs", source = "stopwords-iso"), column_name = "word")

#To be able to lemmatize tokens, we need to download Czech model
udmodel <- udpipe_download_model(language = "czech-pdt", overwrite = FALSE)

# Reshape the data frame into one column called "word"
tidy_dat <- gather(dplyr::as_tibble(data$q50), key, word) %>% 
            dplyr::select(word)

# Tokenize - one word per row of a dataframe/tibble
tokens <- tidy_dat %>%
          unnest_tokens(word, word) %>%
          dplyr::count(word, sort = TRUE) %>%
          ungroup()
                       
#Removing stop words by using anti_join() applied on the stop words list

tokens_clean <- tokens %>%
                anti_join(stop_words_cz)

#Next, we remove numbers (optional step)
nums <- tokens_clean %>% 
        dplyr::filter(str_detect(word, "^[0-9]")) %>% 
        dplyr::select(word) %>% unique()

tokens_clean <- tokens_clean %>% 
  anti_join(nums, by = "word")

#We can also remove unique stop words that are still present (optional step)
uni_sw <- data.frame(word = c("např"))

tokens_clean <- tokens_clean %>% 
  anti_join(uni_sw, by = "word")

#Define a color palette for the Word Cloud
palette <- brewer.pal(8,"Dark2")

#Using seed for reproducibility of the Word Cloud look 
set.seed(2021)

#We generate a Word Cloud using tokens
tokens_clean %>% with(wordcloud(word, 
                                n, 
                                random.order = FALSE,
                                scale = c(7,.5), 
                                min.freq = 1, 
                                max.words = 50, 
                                colors = palette))
```

#### b. Word Clouds of all textual responses, step 2: pre-processing and lemma Word Cloud

```{r Word Cloud all lemma, fig.height=9, fig.width=9, message=FALSE}

#Lemmatization of tokens, using udpipe package
udpipe_tokens_lemma <- udpipe(x = tokens_clean$word,
                                object = udmodel)

tidy_dat_lemma <- gather(dplyr::as_tibble(udpipe_tokens_lemma$lemma),
                         key, 
                         word) %>% 
                  dplyr::select(word) %>% 
                  dplyr::count(word, sort = TRUE)

tokens_clean_lemma <- tidy_dat_lemma %>%
                      anti_join(stop_words_cz)

#Using seed for reproducibility of the word cloud look 
set.seed(2021)

#We generate a Word Cloud using lemma
tokens_clean_lemma %>% with(wordcloud(word,
                                      n, 
                                      random.order = FALSE, 
                                      scale = c(6,.5), 
                                      min.freq = 1, 
                                      max.words = 50, 
                                      colors = palette))
```

#### c. Sentiment analysis of qualitative responses, step 1: pre-processing and Word Cloud with positive valency

```{r Word Cloud positive valency, fig.height=9, fig.width=9, message=FALSE, warning=FALSE}

#First, we load Czech Subjectivity Lexicon from ÚFAL MFF, which assesses sentiment for every word as positive or negative

sentiment_cz <- read_delim("https://lindat.mff.cuni.cz/repository/xmlui/bitstream/handle/11858/00-097C-0000-0022-FF60-B/sublex_1_0.csv?sequence=1&isAllowed=y",
                           "\t", 
                           escape_double = FALSE, 
                           col_names = FALSE, 
                           trim_ws = TRUE) %>% 
                           rename("word" = "X3", "sentiment" = "X4")

#Next, we create tidy tibble with tokens created in the previous section and we use inner_join function to separately save only the tokens with positive and negative valency

tokens_sentiment_positive <- tokens_clean_lemma %>% 
                             inner_join(sentiment_cz %>% 
                             filter(sentiment == "POS")) %>% 
                             count(word, sort = TRUE)

tokens_sentiment_negative <- tokens_clean_lemma %>% 
                             inner_join(sentiment_cz %>% 
                             filter(sentiment == "NEG")) %>% 
                             count(word, sort = TRUE)

#We generate a Word Cloud using only tokens with positive valency

#Using seed for reproducibility of the Word Cloud look 
set.seed(5471)

tokens_sentiment_positive %>% with(wordcloud(word,
                                             n, 
                                             random.order = FALSE, 
                                             scale = c(5,.5), 
                                             max.words = 50,
                                             min.freq = 1,
                                             colors = palette, 
                                             random.color = TRUE))
```

#### d. Sentiment analysis of qualitative responses, step 2: Word Cloud with negative valency

```{r World Cloud negative valency, fig.height=9, fig.width=9, message=FALSE, warning=FALSE}

#Finally, a Word Cloud using only tokens with negative valency

#Using seed for reproducibility of the Word Cloud look 
set.seed(5471)

tokens_sentiment_negative %>% with(wordcloud(word,
                                             n, 
                                             random.order = FALSE, 
                                             scale = c(3,.5), 
                                             max.words = 50, 
                                             min.freq = 1,
                                             colors = palette, 
                                             random.color = TRUE))
```

## 7. Bibliography
